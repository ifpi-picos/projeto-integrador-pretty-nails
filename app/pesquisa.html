<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/pesquisa.css">
    <title>Document</title>
</head>
<body>
    <header>
        <div class="container-de-filtros">
            <div class="header">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Pesquisar perfil...">
                </div>
                <button class="filter-btn" onclick="toggleFilters()">Filtros</button>
            </div>
            
            <div class="filter-panel" id="filterPanel">
                <h3>Filtros</h3>
                <label for="estado">Estado:</label>
                <select id="estado" onchange="carregarCidades()">
                    <option value="">Selecione</option>
                </select>
                
                <label for="cidade">Cidade:</label>
                <select id="cidade">
                    <option value="">Selecione</option>
                </select>
                
                <label for="servico">Serviço:</label>
                <select id="servico">
                    <option value="">Selecione</option>
                    <option value="manicure">Manicure</option>
                    <option value="pedicure">Pedicure</option>
                </select>
                
                <button class="apply-btn">Aplicar</button>
                <button class="close-btn" onclick="toggleFilters()">Fechar</button>
            </div>
        </div>
    </header>
    
    <main>
        <div id="perfilContainer" class="perfil-container"></div>
    </main>

    <script>
        function toggleFilters() {
            document.getElementById("filterPanel").classList.toggle("open");
        }
        
        document.addEventListener("DOMContentLoaded", function () {
            carregarEstados();
        });
        
        const estadosCidades = {
            "AC": ["Rio Branco", "Cruzeiro do Sul", "Sena Madureira", "Tarauacá", "Feijó", "Brasiléia", "Epitaciolândia", "Xapuri", "Senador Guiomard", "Plácido de Castro"],
            "AL": ["Maceió", "Arapiraca", "Palmeira dos Índios", "Rio Largo", "Penedo", "União dos Palmares", "Delmiro Gouveia", "Coruripe", "Campo Alegre", "São Miguel dos Campos"],
            "AP": ["Macapá", "Santana", "Laranjal do Jari", "Oiapoque", "Mazagão", "Porto Grande", "Pedra Branca do Amapari", "Tartarugalzinho", "Vitória do Jari", "Calçoene"],
            "AM": ["Manaus", "Parintins", "Itacoatiara", "Manacapuru", "Coari", "Tefé", "Tabatinga", "Maués", "Humaitá", "Lábrea"],
            "BA": ["Salvador", "Feira de Santana", "Vitória da Conquista", "Camaçari", "Juazeiro", "Itabuna", "Lauro de Freitas", "Ilhéus", "Jequié", "Teixeira de Freitas"],
            "CE": ["Fortaleza", "Caucaia", "Juazeiro do Norte", "Maracanaú", "Sobral", "Crato", "Itapipoca", "Maranguape", "Iguatu", "Quixadá"],
            "DF": ["Brasília"],
            "ES": ["Vitória", "Vila Velha", "Serra", "Cariacica", "Linhares", "São Mateus", "Colatina", "Guarapari", "Aracruz", "Cachoeiro de Itapemirim"],
            "GO": ["Goiânia", "Aparecida de Goiânia", "Anápolis", "Rio Verde", "Luziânia", "Águas Lindas de Goiás", "Valparaíso de Goiás", "Trindade", "Formosa", "Novo Gama"],
            "MA": ["São Luís", "Imperatriz", "Timon", "Caxias", "Codó", "Paço do Lumiar", "Açailândia", "Bacabal", "Balsas", "Santa Inês"],
            "MG": ["Belo Horizonte", "Uberlândia", "Contagem", "Juiz de Fora", "Betim", "Montes Claros", "Ribeirão das Neves", "Uberaba", "Governador Valadares", "Ipatinga"],
            "PA": ["Belém", "Ananindeua", "Santarém", "Marabá", "Castanhal", "Parauapebas", "Abaetetuba", "Cametá", "Bragança", "Altamira"],
            "PI": ["Floriano", "Picos", "Terezina", "Parnaíba", "Piripiri", "Campo Maior", "Barras", "Altos", "Esperantina", "José de Freitas"],
            "PB": ["João Pessoa", "Campina Grande", "Santa Rita", "Patos", "Bayeux", "Sousa", "Cajazeiras", "Guarabira", "Sapé", "Mamanguape"],
            "PR": ["Curitiba", "Londrina", "Maringá", "Ponta Grossa", "Cascavel", "São José dos Pinhais", "Foz do Iguaçu", "Colombo", "Guarapuava", "Paranaguá"],
            "RJ": ["Rio de Janeiro", "São Gonçalo", "Duque de Caxias", "Nova Iguaçu", "Niterói", "Belford Roxo", "Campos dos Goytacazes", "São João de Meriti", "Petrópolis", "Volta Redonda"],
            "SP": ["São Paulo", "Guarulhos", "Campinas", "São Bernardo do Campo", "Santo André", "Osasco", "São José dos Campos", "Ribeirão Preto", "Sorocaba", "Mauá"],
            "RS": ["Porto Alegre", "Caxias do Sul", "Pelotas", "Canoas", "Santa Maria", "Gravataí", "Viamão", "Novo Hamburgo", "São Leopoldo", "Rio Grande"],
            "SC": ["Florianópolis", "Joinville", "Blumenau", "São José", "Chapecó", "Itajaí", "Criciúma", "Jaraguá do Sul", "Lages", "Palhoça"],
            "PE": ["Recife", "Jaboatão dos Guararapes", "Olinda", "Caruaru", "Petrolina", "Paulista", "Cabo de Santo Agostinho", "Camaragibe", "Garanhuns", "Vitória de Santo Antão"],
            "RN": ["Natal", "Mossoró", "Parnamirim", "São Gonçalo do Amarante", "Macau", "Ceará-Mirim", "Caicó", "Açu", "Currais Novos", "Santa Cruz"],
            "MS": ["Campo Grande", "Dourados", "Três Lagoas", "Corumbá", "Ponta Porã", "Naviraí", "Nova Andradina", "Sidrolândia", "Maracaju", "Aquidauana"],
            "MT": ["Cuiabá", "Várzea Grande", "Rondonópolis", "Sinop", "Tangará da Serra", "Sorriso", "Lucas do Rio Verde", "Primavera do Leste", "Barra do Garças", "Alta Floresta"],
            "SE": ["Aracaju", "Nossa Senhora do Socorro", "Lagarto", "Itabaiana", "Estância", "Tobias Barreto", "Simão Dias", "Nossa Senhora da Glória", "Propriá", "Capela"],
            "TO": ["Palmas", "Araguaína", "Gurupi", "Porto Nacional", "Paraíso do Tocantins", "Colinas do Tocantins", "Guaraí", "Tocantinópolis", "Miracema do Tocantins", "Dianópolis"],
            "RO": ["Porto Velho", "Ji-Paraná", "Ariquemes", "Vilhena", "Cacoal", "Rolim de Moura", "Jaru", "Guajará-Mirim", "Machadinho d'Oeste", "Ouro Preto do Oeste"],
            "RR": ["Boa Vista", "Rorainópolis", "Caracaraí", "Mucajaí", "Cantá", "Pacaraima", "Alto Alegre", "Bonfim", "Normandia", "São João da Baliza"]
        };
        
        function carregarEstados() {
            const estadoSelect = document.getElementById("estado");
            for (const estado in estadosCidades) {
                const option = document.createElement("option");
                option.value = estado;
                option.textContent = estado;
                estadoSelect.appendChild(option);
            }
        }
        
        function carregarCidades() {
            const estadoSelecionado = document.getElementById("estado").value;
            const cidadeSelect = document.getElementById("cidade");
        
            cidadeSelect.innerHTML = "<option value=''>Selecione</option>";
        
            if (estadoSelecionado && estadosCidades[estadoSelecionado]) {
                estadosCidades[estadoSelecionado].forEach(cidade => {
                    const option = document.createElement("option");
                    option.value = cidade;
                    option.textContent = cidade;
                    cidadeSelect.appendChild(option);
                });
            }
        }
        
        document.addEventListener("DOMContentLoaded", function () {
            carregarEstados();
            adicionarPerfis();
        
            document.querySelector(".apply-btn").addEventListener("click", function () {
                const estado = document.getElementById("estado").value;
                const cidade = document.getElementById("cidade").value;
                adicionarPerfis(estado, cidade);
            });
        
            document.getElementById("searchInput").addEventListener("input", function () {
                const searchTerm = this.value.toLowerCase();
                const estado = document.getElementById("estado").value;
                const cidade = document.getElementById("cidade").value;
                adicionarPerfis(estado, cidade, searchTerm);
            });
        });
        
        async function adicionarPerfis(filtroEstado = "", filtroCidade = "", filtroNome = "") {
            try {
                const resposta = await fetch("https://back-end-u9vj.onrender.com/manicures");
                if (!resposta.ok) {
                    throw new Error("Erro ao buscar manicures.");
                }
                const manicures = await resposta.json();
        
                const container = document.getElementById("perfilContainer");
                container.innerHTML = ""; // Limpa os perfis existentes
        
                const manicuresFiltradas = manicures.filter(manicure => 
                    (filtroEstado === "" || manicure.estado === filtroEstado) &&
                    (filtroCidade === "" || manicure.cidade === filtroCidade) &&
                    (filtroNome === "" || manicure.name.toLowerCase().includes(filtroNome.toLowerCase()))
                );
        
                manicuresFiltradas.forEach(manicure => {
                    const card = document.createElement("div");
                    card.classList.add("profile-card");
                    card.innerHTML = `
                        <img src="${manicure.foto || 'https://via.placeholder.com/150'}" alt="${manicure.name}">
                        <h3>${manicure.name}</h3>
                        <p>${manicure.cidade}, ${manicure.estado}</p>
                    `;
                    container.appendChild(card);
                });
        
            } catch (error) {
                console.error("Erro ao carregar manicures:", error);
            }
        }        
    </script>

</body>
</html>